# ============================================
# FAKE NEWS DETECTION USING BAGGING (ML PROJECT)
# ============================================

# 1. Import Required Libraries
import pandas as pd
import numpy as np
import re

from sklearn.model_selection import train_test_split
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import BaggingClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix

# --------------------------------------------
# 2. Load Dataset
# --------------------------------------------
# Make sure 'fake_news_dataset.csv' is in the same folder as this notebook

data = pd.read_csv("fake_news_dataset.csv")

print("Dataset Loaded Successfully\n")
print(data.head())

# --------------------------------------------
# 3. Dataset Info
# --------------------------------------------
print("\nDataset Info:")
print(data.info())

print("\nClass Distribution:")
print(data['label'].value_counts())

# --------------------------------------------
# 4. Text Cleaning Function
# --------------------------------------------
def clean_text(text):
    text = text.lower()
    text = re.sub(r'[^a-zA-Z]', ' ', text)
    text = re.sub(r'\s+', ' ', text)
    return text

# --------------------------------------------
# 5. Apply Text Cleaning
# --------------------------------------------
data['clean_text'] = data['text'].apply(clean_text)

# --------------------------------------------
# 6. Feature and Target Split
# --------------------------------------------
X = data['clean_text']
y = data['label']

# --------------------------------------------
# 7. TF-IDF Feature Extraction
# --------------------------------------------
tfidf = TfidfVectorizer(stop_words='english', max_df=0.7)
X_tfidf = tfidf.fit_transform(X)

# --------------------------------------------
# 8. Train-Test Split
# --------------------------------------------
X_train, X_test, y_train, y_test = train_test_split(
    X_tfidf,
    y,
    test_size=0.2,
    random_state=42,
    stratify=y
)

# --------------------------------------------
# 9. Create Bagging Classifier
# --------------------------------------------
base_model = DecisionTreeClassifier(random_state=42)

bagging_model = BaggingClassifier(
    estimator=base_model,
    n_estimators=100,
    random_state=42
)

# --------------------------------------------
# 10. Train the Model
# --------------------------------------------
bagging_model.fit(X_train, y_train)

print("\nModel Training Completed")

# --------------------------------------------
# 11. Prediction
# --------------------------------------------
y_pred = bagging_model.predict(X_test)

# --------------------------------------------
# 12. Model Evaluation
# --------------------------------------------
print("\nAccuracy:", accuracy_score(y_test, y_pred))

print("\nClassification Report:\n")
print(classification_report(y_test, y_pred))

print("Confusion Matrix:\n")
print(confusion_matrix(y_test, y_pred))

# --------------------------------------------
# 13. Save Results for Power BI
# --------------------------------------------
results = pd.DataFrame({
    'Actual_Label': y_test.map({0: 'Real', 1: 'Fake'}),
    'Predicted_Label': pd.Series(y_pred).map({0: 'Real', 1: 'Fake'})
})

results.to_csv("fake_news_results.csv", index=False)
print("\nResults exported to fake_news_results.csv for Power BI")

# --------------------------------------------
# 14. Custom News Prediction Function
# --------------------------------------------
def predict_news(news_text):
    cleaned = clean_text(news_text)
    vector = tfidf.transform([cleaned])
    prediction = bagging_model.predict(vector)
    
    if prediction[0] == 0:
        return "REAL NEWS ✅"
    else:
        return "FAKE NEWS ❌"

# --------------------------------------------
# 15. User Input for Live Testing
# --------------------------------------------
print("\n--- LIVE NEWS TESTING ---")
user_news = input("Enter news text: ")
print("Prediction:", predict_news(user_news))
